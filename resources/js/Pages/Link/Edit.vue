<script setup>
import { useForm, usePage, router } from "@inertiajs/vue3";

import Accordion from "@/Components/Accordion.vue";
import SlideOver from "@/Components/SlideOver.vue";
import Button from "@/Components/Button.vue";
import Input from "@/Components/Input.vue";
import InputError from "@/Components/InputError.vue";
import Label from "@/Components/Label.vue";
import Dropdown from "@/Components/Dropdown.vue";

const domains = usePage().props.domains;
const tags = usePage().props.tags;

const { link } = defineProps({
    link: Object,
});

const form = useForm({
    ...link,
    tags: link.tags.map((t) => t.id),
});

const store = () => {
    form.put(route("links.update", link.id), {
        preserveScroll: true,
        onSuccess: () => {
            form.reset();
            form.clearErrors();
        },
    });
};
</script>

<template>
    <SlideOver
        max-width="2xl"
        :show="true"
        @close="router.visit(route('links.index'))"
    >
        <template #title> Edit Link </template>

        <template #content>
            <Accordion :is-open="true">
                <template #title> General </template>
                <template #content>
                    <div class="col-span-6 lg:col-span-3">
                        <Label
                            for="domain"
                            value="Short Link"
                            :required="true"
                        />
                        <Dropdown
                            id="domain"
                            :options="
                                domains.map((d) => ({
                                    id: d,
                                    label: d,
                                }))
                            "
                            class="w-full"
                            :search="true"
                            placeholder="Select..."
                            v-model="form.domain"
                        />

                        <InputError
                            :message="form.errors.domain"
                            class="mt-2"
                        />
                    </div>

                    <div class="col-span-6 lg:col-span-3">
                        <Label for="key" value="Custom back-half (optional)" />
                        <Input
                            id="key"
                            type="text"
                            v-model="form.key"
                            placeholder="e.g. super-link"
                        />

                        <InputError :message="form.errors.key" class="mt-2" />
                    </div>
                    <div class="col-span-6">
                        <Label
                            for="url"
                            value="Destination URL"
                            :required="true"
                        />
                        <Input
                            id="url"
                            type="text"
                            v-model="form.url"
                            placeholder="e.g. https://example.com"
                        />
                        <InputError :message="form.errors.url" class="mt-2" />
                    </div>

                    <div class="col-span-6">
                        <Label for="tags" value="Tags" />

                        <Dropdown
                            id="tags"
                            :options="
                                tags.map((t) => ({
                                    id: t.id,
                                    label: t.name,
                                }))
                            "
                            class="w-full"
                            :search="true"
                            :multiple="true"
                            placeholder="Select..."
                            v-model="form.tags"
                        />

                        <InputError :message="form.errors.tags" class="mt-2" />
                    </div>
                </template>
            </Accordion>

            <Accordion :is-open="true">
                <template #title> Targeted Traffic </template>
                <template #content>
                    <div class="col-span-6">
                        <Label for="ios" value="iOS URL" :required="false" />
                        <Input
                            id="ios"
                            type="text"
                            v-model="form.ios"
                            placeholder="e.g. https://apps.apple.com/app/333903271"
                        />
                        <InputError :message="form.errors.ios" class="mt-2" />
                    </div>

                    <div class="col-span-6">
                        <Label
                            for="android"
                            value="Android URL"
                            :required="false"
                        />
                        <Input
                            id="android"
                            type="text"
                            v-model="form.android"
                            placeholder="e.g. https://play.google.com/store/apps/details?id=com.twitter.android"
                        />
                        <InputError
                            :message="form.errors.android"
                            class="mt-2"
                        />
                    </div>
                </template>
            </Accordion>
        </template>

        <template #footer>
            <Button
                @click="store"
                :class="{
                    'opacity-25': form.processing,
                    'btn-primary': true,
                }"
                :disabled="form.processing"
            >
                Update Link
            </Button>
        </template>
    </SlideOver>
</template>
